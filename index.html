<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Управление продукцией и контактами с Vue.js</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        .container {
            width: 80%;
            margin: 50px auto;
            background: #fff;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #333;
        }
        /* Стили для таблицы */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            color: #333;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        tr:hover {
            background-color: #f1f1f1;
        }
        .action-button {
            background-color: #4CAF50;
            color: white;
            padding: 5px 10px;
            border: none;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
            margin: 2px;
            transition-duration: 0.4s;
        }
        .action-button.edit {
            background-color: #007BFF;
        }
        .action-button.delete {
            background-color: #DC3545;
        }
        .action-button:hover {
            opacity: 0.8;
        }
        /* Стили для формы добавления */
        input, textarea, select {
            width: 100%;
            padding: 10px;
            margin: 5px 0 10px 0;
            display: inline-block;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        input[type="submit"] {
            width: auto;
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
        }
        input[type="submit"]:hover {
            background-color: #45a049;
        }
        /* Стили для вкладок */
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab.active {
            background-color: #fff;
            border-bottom: 1px solid #fff;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .download-button, .upload-button {
            display: inline-block;
            padding: 10px 50px;
            background-color: #28a745;
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 5px;
        }
        .download-button:hover, .upload-button:hover {
            background-color: #218838;
        }
        .file-upload-wrapper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .custom-file-upload {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007BFF;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        .custom-file-upload:hover {
            background-color: #0056b3;
        }
        .custom-file-upload i {
            margin-right: 8px;
        }
        #cancel {
            padding: 10px 20px;
            font-size: 13px;
        }
        .required-field::after {
            content: " *";
            color: red;
        }
        .error-message {
            color: red;
            font-size: 12px;
            margin-top: -8px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

<!-- Контейнер для управления продуктами и контактами -->
<div id="app" class="container">
    <div class="file-upload-wrapper">
		<button class="download-button" @click="saveDataToJsonBin">Сохранить данные в JSONBin</button>
	</div>

    <div class="tabs">
        <div class="tab" :class="{ active: activeTab === 'products' }" @click="activeTab = 'products'">Список продукции</div>
        <div class="tab" :class="{ active: activeTab === 'add-product' }" @click="activeTab = 'add-product'">Добавить товар</div>
        <div class="tab" :class="{ active: activeTab === 'contacts' }" @click="activeTab = 'contacts'">Контактная информация</div>
        <div class="tab" :class="{ active: activeTab === 'faq' }" @click="activeTab = 'faq'">Вопросы и Ответы</div>
        <div class="tab" :class="{ active: activeTab === 'add-faq' }" @click="activeTab = 'add-faq'">Добавить вопрос и ответ</div>
    </div>

    <!-- Вкладка со списком продукции -->
    <div v-if="activeTab === 'products'" class="tab-content active">
        <h2>Список продукции</h2>
        <table>
            <thead>
                <tr>
                    <th>Название</th>
                    <th>Бренд</th>
                    <th>Тип загара</th>
                    <th>Цена</th>
                    <th>Действие</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="product in products" :key="product.id">
                    <td>{{ product.name }}</td>
                    <td>{{ product.brand || '-' }}</td>
                    <td>{{ product.tan_type }}</td>
                    <td>€{{ product.price.toFixed(2) }}</td>
                    <td>
                        <button class="action-button edit" @click="editProduct(product)">Изменить</button>
                        <button class="action-button delete" @click="deleteProduct(product.id)">Удалить</button>
                    </td>
                </tr>
                <tr v-if="products.length === 0">
                    <td colspan="5" style="text-align: center;">Список продукции пуст</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Вкладка с формой добавления товара -->
    <div v-if="activeTab === 'add-product'" class="tab-content active">
        <h2>{{ isEditingProduct ? 'Изменить товар' : 'Добавить новый товар' }}</h2>
        <form @submit.prevent="validateProductForm">
            <label for="product_name" class="required-field">Название продукта</label>
            <input type="text" v-model="currentProduct.name" required>
            <div v-if="errors.name" class="error-message">{{ errors.name }}</div>

            <label for="price" class="required-field">Цена</label>
            <input type="number" step="0.01" v-model="currentProduct.price" required>
            <div v-if="errors.price" class="error-message">{{ errors.price }}</div>

            <label for="tan_type" class="required-field">Тип загара</label>
            <select v-model="currentProduct.tan_type" required>
                <option value="">-- Выберите тип --</option>
                <option value="Моментальный загар">Моментальный загар</option>
                <option value="Естественный загар">Естественный загар</option>
            </select>
            <div v-if="errors.tan_type" class="error-message">{{ errors.tan_type }}</div>

            <label for="image_names" class="required-field">URL изображений</label>
            <textarea v-model="currentProduct.image_names" rows="4" placeholder="Введите ссылку(и) на изображение(я), разделяя их запятыми" required></textarea>
            <div v-if="errors.image_names" class="error-message">{{ errors.image_names }}</div>
			
			<label for="brand">Бренд</label>
            <input type="text" v-model="currentProduct.brand">

            <label for="description">Описание</label>
            <textarea v-model="currentProduct.description" rows="4"></textarea>

            <label for="composition">Состав</label>
            <textarea v-model="currentProduct.composition" rows="4"></textarea>

            <label for="skin_type">Тип кожи</label>
            <select v-model="currentProduct.skin_type">
                <option value="">-- Выберите тип --</option>
                <option value="dry">Сухая</option>
                <option value="oily">Жирная</option>
                <option value="combination">Комбинированная</option>
                <option value="sensitive">Чувствительная</option>
                <option value="normal">Нормальная</option>
            </select>

            <label for="volume">Объем/Вес</label>
            <input type="text" v-model="currentProduct.volume">

            <label for="expiration_date">Срок годности</label>
            <input type="date" v-model="currentProduct.expiration_date">

            <input type="submit" :value="isEditingProduct ? 'Сохранить' : 'Добавить товар'">
        </form>
		<p><span style="color:red;">*</span> - <small>обязательное поле</small></p>
    </div>

    <!-- Вкладка с контактной информацией -->
    <div v-if="activeTab === 'contacts'" class="tab-content active">
        <h2>Контактная информация</h2>
        <table>
            <thead>
                <tr>
                    <th>Телефон</th>
                    <th>WhatsApp</th>
                    <th>Telegram</th>
                    <th>Действие</th>
                </tr>
            </thead>
            <tbody>
                <tr v-if="contact">
                    <td>{{ contact.phone }}</td>
                    <td>{{ contact.whatsapp }}</td>
                    <td>{{ contact.telegram || '-' }}</td>
                    <td>
                        <button class="action-button edit" @click="editContact(contact)">Изменить</button>
                    </td>
                </tr>
                <tr v-else>
                    <td colspan="4" style="text-align: center;">Контактная информация не добавлена</td>
                </tr>
            </tbody>
        </table>
        <button class="action-button" @click="addNewContact" style="font-size: 13px; padding: 10px 20px; margin-top: 20px;" v-if="!contact">Добавить контакт</button>
    </div>

    <!-- Вкладка с формой редактирования контакта -->
    <div v-if="activeTab === 'add-contact'" class="tab-content active">
        <h2>{{ isEditingContact ? 'Изменить контакт' : 'Добавить контакт' }}</h2>
        <form @submit.prevent="validateContactForm">
            <label for="phone" class="required-field">Телефон</label>
            <input type="text" v-model="currentContact.phone" required>
            <div v-if="errors.phone" class="error-message">{{ errors.phone }}</div>

            <label for="whatsapp" class="required-field">WhatsApp</label>
            <input type="text" v-model="currentContact.whatsapp" required>
            <div v-if="errors.whatsapp" class="error-message">{{ errors.whatsapp }}</div>

            <label for="email">Email</label>
            <input type="email" v-model="currentContact.email">

            <label for="telegram">Telegram</label>
            <input type="text" v-model="currentContact.telegram">

            <label for="address">Адрес</label>
            <textarea v-model="currentContact.address" rows="2"></textarea>

            <input type="submit" :value="isEditingContact ? 'Сохранить' : 'Добавить контакт'">
            <button type="button" id="cancel" class="action-button delete" @click="cancelContactEdit" style="margin-left: 10px;">Отмена</button>
        </form>
		<p><span style="color:red;">*</span> - <small>обязательное поле</small></p>
    </div>

    <!-- Вкладка со списком вопросов и ответов -->
    <div v-if="activeTab === 'faq'" class="tab-content active">
        <h2>Вопросы и Ответы</h2>
        <table>
            <thead>
                <tr>
                    <th>Вопрос</th>
                    <th>Ответ</th>
                    <th>Действие</th>
                </tr>
            </thead>
            <tbody>
                <tr v-for="faq in faqs" :key="faq.id">
                    <td>{{ faq.question }}</td>
                    <td>{{ faq.answer }}</td>
                    <td>
                        <button class="action-button edit" @click="editFaq(faq)">Изменить</button>
                        <button class="action-button delete" @click="deleteFaq(faq.id)">Удалить</button>
                    </td>
                </tr>
                <tr v-if="faqs.length === 0">
                    <td colspan="3" style="text-align: center;">Список вопросов и ответов пуст</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Вкладка с формой добавления вопроса и ответа -->
    <div v-if="activeTab === 'add-faq'" class="tab-content active">
        <h2>{{ isEditingFaq ? 'Изменить вопрос и ответ' : 'Добавить новый вопрос и ответ' }}</h2>
        <form @submit.prevent="validateFaqForm">
            <label for="question" class="required-field">Вопрос</label>
            <input type="text" v-model="currentFaq.question" required>
            <div v-if="errors.question" class="error-message">{{ errors.question }}</div>

            <label for="answer" class="required-field">Ответ</label>
            <textarea v-model="currentFaq.answer" rows="4" required></textarea>
            <div v-if="errors.answer" class="error-message">{{ errors.answer }}</div>

            <input type="submit" :value="isEditingFaq ? 'Сохранить' : 'Добавить вопрос и ответ'">
        </form>
		<p><span style="color:red;">*</span> - <small>обязательное поле</small></p>
    </div>
</div>

<script>
new Vue({
    el: '#app',
    data: {
        activeTab: 'products',
        isEditingProduct: false,
        currentProduct: {
            name: '',
            brand: '',
            tan_type: '',
            price: 0,
            description: '',
            composition: '',
            skin_type: '',
            volume: '',
            expiration_date: '',
            image_names: ''
        },
        products: [],
        isEditingContact: false,
        currentContact: {
            phone: '',
            whatsapp: '',
            email: '',
            telegram: '',
            address: ''
        },
        contact: null,
        isEditingFaq: false,
        currentFaq: {
            question: '',
            answer: ''
        },
        faqs: [],
        errors: {}
    },
    methods: {
        validateProductForm() {
            this.errors = {};
            let isValid = true;
            
            if (!this.currentProduct.name) {
                this.errors.name = 'Пожалуйста, введите название продукта';
                isValid = false;
            }
            
            if (!this.currentProduct.price || isNaN(this.currentProduct.price) || this.currentProduct.price <= 0) {
                this.errors.price = 'Пожалуйста, введите корректную цену';
                isValid = false;
            }
            
            if (!this.currentProduct.tan_type) {
                this.errors.tan_type = 'Пожалуйста, выберите тип загара';
                isValid = false;
            }
            
            if (!this.currentProduct.image_names) {
                this.errors.image_names = 'Пожалуйста, укажите URL изображений';
                isValid = false;
            }
            
            if (isValid) {
                this.saveProduct();
            }
        },
        validateContactForm() {
            this.errors = {};
            let isValid = true;
            
            if (!this.currentContact.phone) {
                this.errors.phone = 'Пожалуйста, введите телефон';
                isValid = false;
            }
            
            if (!this.currentContact.whatsapp) {
                this.errors.whatsapp = 'Пожалуйста, введите WhatsApp';
                isValid = false;
            }
            
            if (isValid) {
                this.saveContact();
            }
        },
        validateFaqForm() {
            this.errors = {};
            let isValid = true;
            
            if (!this.currentFaq.question) {
                this.errors.question = 'Пожалуйста, введите вопрос';
                isValid = false;
            }
            
            if (!this.currentFaq.answer) {
                this.errors.answer = 'Пожалуйста, введите ответ';
                isValid = false;
            }
            
            if (isValid) {
                this.saveFaq();
            }
        },
        editProduct(product) {
            this.currentProduct = { ...product, image_names: product.images.join(', ') };
            this.isEditingProduct = true;
            this.activeTab = 'add-product';
        },
        deleteProduct(productId) {
            if (confirm('Вы уверены, что хотите удалить этот товар?')) {
                this.products = this.products.filter(product => product.id !== productId);
            }
        },
        saveProduct() {
            const imageUrls = this.currentProduct.image_names.split(',').map(name => name.trim());
            const price = parseFloat(this.currentProduct.price);

            if (this.isEditingProduct) {
                const index = this.products.findIndex(p => p.id === this.currentProduct.id);
                if (index !== -1) {
                    this.products.splice(index, 1, {
                        ...this.currentProduct,
                        price: price,
                        images: imageUrls
                    });
                }
            } else {
                this.products.push({
                    id: this.products.length > 0 ? Math.max(...this.products.map(p => p.id)) + 1 : 1,
                    ...this.currentProduct,
                    price: price,
                    images: imageUrls
                });
            }
            this.resetProductForm();
            this.activeTab = 'products';
        },
        resetProductForm() {
            this.currentProduct = {
                name: '',
                brand: '',
                tan_type: '',
                price: 0,
                description: '',
                composition: '',
                skin_type: '',
                volume: '',
                expiration_date: '',
                image_names: ''
            };
            this.isEditingProduct = false;
            this.errors = {};
        },
        addNewContact() {
            this.currentContact = {
                phone: '',
                whatsapp: '',
                email: '',
                telegram: '',
                address: ''
            };
            this.isEditingContact = false;
            this.activeTab = 'add-contact';
        },
        editContact(contact) {
            this.currentContact = { ...contact };
            this.isEditingContact = true;
            this.activeTab = 'add-contact';
        },
        saveContact() {
            this.contact = { ...this.currentContact };
            this.resetContactForm();
            this.activeTab = 'contacts';
        },
        cancelContactEdit() {
            this.resetContactForm();
            this.activeTab = 'contacts';
        },
        resetContactForm() {
            this.currentContact = {
                phone: '',
                whatsapp: '',
                email: '',
                telegram: '',
                address: ''
            };
            this.isEditingContact = false;
            this.errors = {};
        },
        editFaq(faq) {
            this.currentFaq = { ...faq };
            this.isEditingFaq = true;
            this.activeTab = 'add-faq';
        },
        deleteFaq(faqId) {
            if (confirm('Вы уверены, что хотите удалить этот вопрос?')) {
                this.faqs = this.faqs.filter(faq => faq.id !== faqId);
            }
        },
        saveFaq() {
            if (this.isEditingFaq) {
                const index = this.faqs.findIndex(f => f.id === this.currentFaq.id);
                if (index !== -1) {
                    this.faqs.splice(index, 1, { ...this.currentFaq });
                }
            } else {
                this.faqs.push({
                    id: this.faqs.length > 0 ? Math.max(...this.faqs.map(f => f.id)) + 1 : 1,
                    ...this.currentFaq
                });
            }
            this.resetFaqForm();
            this.activeTab = 'faq';
        },
        resetFaqForm() {
            this.currentFaq = {
                question: '',
                answer: ''
            };
            this.isEditingFaq = false;
            this.errors = {};
        },
        async saveDataToJsonBin() {
		    const binId = '681c9ce78561e97a500fec24';
			const apiKey = '$2a$10$wVEfmzIO0EeHOvg8x4oNEOWHJgzIYW5z5HmluHqXBLecCChC820Ji';
			const data = {
				products: this.products,
				contact: this.contact,
				faqs: this.faqs
			};
			try {
				const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}`, {
					method: 'PUT',
					headers: {
						'Content-Type': 'application/json',
						'X-Master-Key': apiKey
					},
					body: JSON.stringify(data)
				});
				if (response.ok) {
					alert('Данные успешно сохранены!');
				} else {
					alert('Ошибка при сохранении данных.');
				}
			} catch (error) {
				alert('Ошибка при сохранении данных.');
			}
		},
        async loadDataFromJsonBin() {
		    const binId = '681c9ce78561e97a500fec24';
			const apiKey = '$2a$10$wVEfmzIO0EeHOvg8x4oNEOWHJgzIYW5z5HmluHqXBLecCChC820Ji';
            try {
                const response = await fetch(`https://api.jsonbin.io/v3/b/${binId}/latest`, {
                    headers: {
                        'X-Master-Key': apiKey
                    }
                });
                const data = await response.json();
                this.products = data.record.products || [];
                this.contact = data.record.contact || null;
                this.faqs = data.record.faqs || [];
                console.log('Данные успешно загружены!');
            } catch (error) {
                console.error('Ошибка при загрузке данных:', error);
            }
        }
    },
	mounted() {
        this.loadDataFromJsonBin();
    }
});
/*
downloadJson() {
            const data = {
                products: this.products,
                contact: this.contact,
                faqs: this.faqs
            };
            const jsonData = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'data.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        },
        uploadJson(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data) {
                            this.products = data.products || [];
                            this.contact = data.contact || null;
                            this.faqs = data.faqs || [];
                            alert('Данные успешно загружены!');
                        } else {
                            alert('Неверный формат файла.');
                        }
                    } catch (error) {
                        alert('Ошибка при чтении файла.');
                    }
                };
                reader.readAsText(file);
            }
        }
*/
</script>

</body>
</html>